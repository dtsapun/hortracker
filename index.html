<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Клікер + секундомір + TOTP генератор</title>
<style>
  body {
    margin: 0;
    padding: 10px;
    font-family: monospace;
    background: #f7f7f7;
  }
  #container {
  display: flex;
  flex-direction: column;
  gap: 6px;
  background: #fff;
  border: 1px solid #aaa;
  padding: 6px;
  box-shadow: 0 0 4px rgba(0,0,0,0.2);

  /* Нові властивості */
  max-width: 360px;
  margin: 0 auto;
}

#stopwatch {
  font-size: 28px;   /* було 13-14px */
  font-weight: bold;
  min-width: 70px;
  text-align: center;
}
  .topRow {
    display: flex;
    gap: 4px;
    flex-wrap: nowrap;
  }
  .counterBlock {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2px;
    border: 1px solid #ccc;
    border-radius: 3px;
    background: #fafafa;
    flex: 1;
    min-width: 80px;
  }
  .counterBlock button {
    width: 100%;
    font-size: 13px;
    padding: 4px;
    background: #eee;
    border: 1px solid #ccc;
    border-radius: 3px;
    cursor: pointer;
  }
  .counterBlock input {
    width: 50px;
    margin-top: 2px;
    text-align: center;
    font-size: 13px;
    padding: 1px;
  }
  .totalsBox {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 4px;
    border: 1px solid #ccc;
    border-radius: 3px;
    background: #fafafa;
    min-width: 80px;
    font-size: 12px;
  }
  #stopwatchRow {
    display: flex;
    gap: 4px;
    align-items: center;
    justify-content: center;
  }
  #toggleStopwatch, #resetAll, #toggleTotp, #pause {
    font-size: 12px;
    padding: 4px 6px;
    border: 1px solid #ccc;
    background: #eee;
    border-radius: 3px;
    cursor: pointer;
  }
  #resetAll {
    margin-top: 4px;
    background: #f5f5f5;
  }
  #totpContainer {
    display: none;
    border-top: 1px solid #ccc;
    padding-top: 6px;
  }
  #totpSecret {
    width: 100%;
    padding: 4px;
    font-size: 13px;
    box-sizing: border-box;
  }
  #totpCode {
    margin: 4px 0;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    letter-spacing: 4px;
    cursor: pointer;
  }
  #totpTimer {
    font-size: 12px;
    text-align: center;
  }
  #copyMsg {
    font-size: 11px;
    color: green;
    display: none;
  }
  #copyMsg.show { display: inline; }
</style>
</head>
<body>
<div id="container">
  <div class="topRow">
    <div class="counterBlock">
      <button id="btn1">Video</button>
      <input id="click1" type="number" min="0" step="1" value="0">
    </div>
    <div class="counterBlock">
      <button id="btn2">Comment</button>
      <input id="click2" type="number" min="0" step="1" value="0">
    </div>
    <div class="counterBlock">
      <button id="btn3">Post</button>
      <input id="click3" type="number" min="0" step="1" value="0">
    </div>
    <div class="totalsBox">
      <div>%: <span id="totalPercent">0.00%</span></div>
      <div>Σ: <span id="totalClicks">0</span></div>
    </div>
  </div>

  <div id="stopwatchRow">
    <div id="stopwatch">00:00</div>
    <button id="pause">Pause</button>
    <button id="toggleStopwatch">⏱</button>
    <button id="toggleTotp">TOTP</button>
  </div>

  <div id="totpContainer">
    <input id="totpSecret" placeholder="Secret code">
    <div id="totpCode">------ <span id="copyMsg">Copied!</span></div>
    <div id="totpTimer"></div>
  </div>

  <button id="resetAll">Скинути все</button>
</div>

<script>
(function(){
  const weight1 = 0.83, weight2 = 0.2, weight3 = 0.6;
  const input1 = document.getElementById('click1'),
        input2 = document.getElementById('click2'),
        input3 = document.getElementById('click3'),
        btn1 = document.getElementById('btn1'),
        btn2 = document.getElementById('btn2'),
        btn3 = document.getElementById('btn3'),
        totalPercentSpan = document.getElementById('totalPercent'),
        totalClicksSpan = document.getElementById('totalClicks'),
        stopwatch = document.getElementById('stopwatch'),
        pauseBtn = document.getElementById('pause'),
        toggleStopwatchBtn = document.getElementById('toggleStopwatch'),
        resetAllBtn = document.getElementById('resetAll'),
        btnTotp = document.getElementById('toggleTotp'),
        totpContainer = document.getElementById('totpContainer'),
        secretInput = document.getElementById('totpSecret'),
        codeDisplay = document.getElementById('totpCode'),
        timerDisplay = document.getElementById('totpTimer'),
        copyMsg = document.getElementById('copyMsg');

  let startTime = null, timerInterval = null, running = false;
  function formatTime(ms){
    let s = Math.floor(ms / 1000),
        m = String(Math.floor(s / 60)).padStart(2,'0'),
        sec = String(s % 60).padStart(2,'0');
    return m+":"+sec;
  }
  function updateTimer(){
    if(running) stopwatch.textContent = formatTime(Date.now() - startTime);
  }
  function startStopwatch(){
    startTime = Date.now();
    running = true;
    clearInterval(timerInterval);
    timerInterval = setInterval(updateTimer, 250);
  }
  function pauseStopwatch(){
    clearInterval(timerInterval);
    running = false;
    stopwatch.textContent = '00:00';
    startTime = null;
  }
  function updateTotals(){
    let v1 = +input1.value||0,
        v2 = +input2.value||0,
        v3 = +input3.value||0;
    totalClicksSpan.textContent = v1+v2+v3;
    totalPercentSpan.textContent = (v1*weight1 + v2*weight2 + v3*weight3).toFixed(2) + '%';
  }

  btn1.onclick = ()=>{input1.value=+input1.value+1;updateTotals();startStopwatch();};
  btn2.onclick = ()=>{input2.value=+input2.value+1;updateTotals();startStopwatch();};
  btn3.onclick = ()=>{input3.value=+input3.value+1;updateTotals();startStopwatch();};
  [input1,input2,input3].forEach(el=>el.addEventListener('input',updateTotals));
  pauseBtn.onclick = pauseStopwatch;
  toggleStopwatchBtn.onclick = ()=>{stopwatch.style.display = stopwatch.style.display==='none'?'block':'none'; saveState();};
  resetAllBtn.onclick = ()=>{input1.value=0;input2.value=0;input3.value=0;updateTotals();pauseStopwatch();saveState();};

  // --- TOTP ---
  function base32tohex(base32){
    const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    let bits="", hex="";
    base32 = base32.replace(/=+$/,"").toUpperCase();
    for(let c of base32){let val=chars.indexOf(c); if(val<0) return null; bits+=val.toString(2).padStart(5,"0");}
    for(let i=0;i+4<=bits.length;i+=4){hex+=parseInt(bits.substr(i,4),2).toString(16);}
    return hex;
  }
  function hexToBytes(hex){let b=new Uint8Array(hex.length/2);for(let i=0;i<b.length;i++) b[i]=parseInt(hex.substr(i*2,2),16);return b;}
  async function hmacSha1(keyHex,msgHex){
    const keyBytes=hexToBytes(keyHex), msgBytes=hexToBytes(msgHex);
    const cryptoKey = await crypto.subtle.importKey("raw",keyBytes,{name:"HMAC",hash:"SHA-1"},false,["sign"]);
    return new Uint8Array(await crypto.subtle.sign("HMAC", cryptoKey, msgBytes));
  }
  async function generateTOTP(secret, step=30){
    let keyHex=base32tohex(secret); if(!keyHex) return null;
    let epoch=Math.floor(Date.now()/1000), time=Math.floor(epoch/step),
        timeHex=time.toString(16).padStart(16,"0");
    let hmac=await hmacSha1(keyHex,timeHex); if(!hmac) return null;
    let offset=hmac[hmac.length-1]&0xf;
    let code=((hmac[offset]&0x7f)<<24)|((hmac[offset+1]&0xff)<<16)|((hmac[offset+2]&0xff)<<8)|(hmac[offset+3]&0xff);
    return (code % 1e6).toString().padStart(6,"0");
  }
  async function updateTotpCode(){
    const s=secretInput.value.trim();
    if(!s){codeDisplay.textContent="------";return;}
    try{codeDisplay.textContent=await generateTOTP(s)||"Error";}catch(e){codeDisplay.textContent="Error";}
  }
  let lastStep=null, totpInterval=null;
  function startTotp(){
    updateTotpCode();
    clearInterval(totpInterval);
    totpInterval=setInterval(()=>{
      let epoch=Math.floor(Date.now()/1000),
          step=Math.floor(epoch/30),
          left=30-(epoch%30);
      timerDisplay.textContent=`Update in ${left}s`;
      if(step!==lastStep){lastStep=step;updateTotpCode();}
    },1000);
  }
  function stopTotp(){clearInterval(totpInterval);timerDisplay.textContent="";}
  btnTotp.onclick=()=>{if(totpContainer.style.display==='none'){totpContainer.style.display='block';startTotp();}else{totpContainer.style.display='none';stopTotp();saveState();}};
  codeDisplay.onclick=()=>{let t=codeDisplay.textContent.trim();if(t&&t!=='------'&&t!=='Error'){navigator.clipboard.writeText(t).then(()=>{copyMsg.classList.add('show');setTimeout(()=>copyMsg.classList.remove('show'),1500);});}};

  // --- localStorage ---
  function saveState(){
    localStorage.setItem('appState', JSON.stringify({
      click1:+input1.value||0,
      click2:+input2.value||0,
      click3:+input3.value||0,
      secret:secretInput.value||'',
      showStopwatch:stopwatch.style.display!=='none',
      showTotp:totpContainer.style.display!=='none'
    }));
  }
  function loadState(){
    let st={};try{st=JSON.parse(localStorage.getItem('appState')||'{}');}catch(e){}
    if(st.click1!==undefined) input1.value=st.click1;
    if(st.click2!==undefined) input2.value=st.click2;
    if(st.click3!==undefined) input3.value=st.click3;
    if(st.secret) secretInput.value=st.secret;
    stopwatch.style.display=st.showStopwatch===false?'none':'block';
    if(st.showTotp){totpContainer.style.display='block';if(secretInput.value.trim())startTotp();}
    updateTotals();
  }
  [input1,input2,input3,secretInput].forEach(el=>el.addEventListener('input',saveState));
  [btn1,btn2,btn3,pauseBtn,btnTotp].forEach(el=>el.addEventListener('click',saveState));

  loadState();
})();
</script>
</body>
</html>
